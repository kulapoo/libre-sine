import{r,j as e,F as W,R as T,z as v}from"./index-DJiFHe4L.js";import{d as H,v as q,a as Y,u as K,b as Q,c as X,M as ee,e as se}from"./MovieForm-DqYBQSq_.js";import{S as te}from"./SearchBar-BWBS20zz.js";import"./StarIcon-CiHnNQHP.js";function re({title:a,titleId:i,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},c),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}const ae=r.forwardRef(re);function oe({title:a,titleId:i,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},c),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))}const ne=r.forwardRef(oe);function le({title:a,titleId:i,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},c),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const ie=r.forwardRef(le);function ce({title:a,titleId:i,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},c),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const de=r.forwardRef(ce);function ue({title:a,titleId:i,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},c),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const me=r.forwardRef(ue);function ge({title:a,titleId:i,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},c),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const pe=r.forwardRef(ge);function U(a,i,c){const[u,f]=r.useState(()=>{try{const d=localStorage.getItem(a);if(d!==null){const p=JSON.parse(d);if(!c||c(p))return p}}catch(d){console.error(`Failed to load persisted state for ${a}:`,d)}return i}),M=r.useCallback(d=>{f(d);try{localStorage.setItem(a,JSON.stringify(d))}catch(p){console.error(`Failed to persist state for ${a}:`,p)}},[a]);return r.useEffect(()=>{const d=p=>{if(p.key===a&&p.newValue)try{const b=JSON.parse(p.newValue);(!c||c(b))&&f(b)}catch(b){console.error(`Failed to sync persisted state for ${a}:`,b)}};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)},[a,c]),[u,M]}const z=({message:a,onConfirm:i,onCancel:c,confirmText:u="Confirm",cancelText:f="Cancel"})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(de,{className:"h-6 w-6 text-amber-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Confirmation Required"})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:a}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:u}),e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:f})]})]})}),xe=({onImport:a,onCancel:i})=>{const[c,u]=r.useState(!1),[f,M]=r.useState(null),[d,p]=r.useState(null),[b,F]=r.useState(!1),[D,w]=r.useState(!1),[N,j]=r.useState(!1),[m,A]=r.useState([]),C=(s,o)=>{const n=[];if((!s.name||typeof s.name!="string"||!s.name.trim())&&n.push(`Movie ${o+1}: Name is required`),!s.movie_url||typeof s.movie_url!="string")n.push(`Movie ${o+1}: Movie URL is required`);else{const l=q(s.movie_url);l&&n.push(`Movie ${o+1}: ${l}`)}if(s.image_url&&typeof s.image_url=="string"){const l=Y(s.image_url);l&&n.push(`Movie ${o+1}: ${l}`)}return s.rating!==void 0&&(typeof s.rating!="number"||s.rating<1||s.rating>10)&&n.push(`Movie ${o+1}: Rating must be a number between 1 and 10`),s.genres&&!Array.isArray(s.genres)&&n.push(`Movie ${o+1}: Genres must be an array`),s.actors&&!Array.isArray(s.actors)&&n.push(`Movie ${o+1}: Actors must be an array`),n},_=async s=>{const o=[];let n=[];if(Array.isArray(s))n=s;else if(typeof s=="object"&&s!==null&&"movies"in s&&Array.isArray(s.movies))n=s.movies;else return{isValid:!1,errors:['Invalid JSON structure. Expected an array of movies or an object with a "movies" array.'],duplicates:[]};if(n.length===0)return{isValid:!1,errors:["No movies found in the file."],duplicates:[]};for(let x=0;x<n.length;x++){const h=C(n[x],x);o.push(...h)}const l=[];for(let x=0;x<n.length;x++){const h=n[x];if(h.name&&h.movie_url&&await H.checkMovieExists(h.name,h.movie_url)){l.push({movie:h,index:x});break}}return{isValid:o.length===0,errors:o,duplicates:l}},L=async s=>new Promise((o,n)=>{const l=new FileReader;l.onload=x=>{try{const h=JSON.parse(x.target?.result);o(h)}catch{n(new Error("Invalid JSON file format."))}},l.onerror=()=>n(new Error("Failed to read file.")),l.readAsText(s)}),R=s=>(Array.isArray(s)?s:s.movies||[]).map(n=>{const l=n;return{name:l.name||"",movie_url:l.movie_url||"",image_url:l.image_url||"",description:l.description||"",rating:l.rating||5,genres:l.genres||[],director:l.director||"",actors:l.actors||[]}}),$=async s=>{if(!s.type.includes("json")){p({isValid:!1,errors:["Please select a valid JSON file."],duplicates:[]});return}M(s),F(!0),p(null);try{const o=await L(s),n=await _(o);if(p(n),n.isValid){const l=R(o);if(A(l),l.length>20){w(!0);return}if(n.duplicates.length>0){j(!0);return}a(l)}}catch(o){p({isValid:!1,errors:[o instanceof Error?o.message:"Failed to process file."],duplicates:[]})}finally{F(!1)}},I=s=>{s.preventDefault(),s.stopPropagation()},k=s=>{s.preventDefault(),s.stopPropagation(),u(!0)},O=s=>{s.preventDefault(),s.stopPropagation(),u(!1)},S=s=>{s.preventDefault(),s.stopPropagation(),u(!1);const o=s.dataTransfer.files;o&&o[0]&&$(o[0])},E=s=>{const o=s.target.files;o&&o[0]&&$(o[0])},P=()=>{w(!1),d?.duplicates.length?j(!0):a(m)},V=()=>{j(!1),a(m)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-40",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Import Movies from JSON"}),e.jsx("button",{onClick:i,className:"text-gray-500 hover:text-gray-700",children:e.jsx(W,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:f.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(f.size/1024).toFixed(2)," KB"]})]}),e.jsx("button",{onClick:()=>{M(null),p(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx(W,{className:"h-5 w-5"})})]}),b&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Validating movies..."})]}),d&&!b&&e.jsx("div",{className:"space-y-4",children:d.isValid?e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("p",{className:"text-green-800 font-medium",children:["✓ Validation successful! Ready to import ",m.length," movies."]}),d.duplicates.length>0&&e.jsxs("p",{className:"text-amber-600 text-sm mt-2",children:["Note: ",d.duplicates.length," duplicate(s) detected and will be handled."]})]}):e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"Validation failed:"}),e.jsx("ul",{className:"text-red-700 text-sm space-y-1",children:d.errors.map((s,o)=>e.jsxs("li",{children:["• ",s]},o))})]})})]}):e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${c?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:k,onDragLeave:O,onDragOver:I,onDrop:S,children:[e.jsx(ie,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"Drop your JSON file here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Upload a JSON file containing movie data to import multiple movies at once."}),e.jsx("input",{type:"file",accept:".json",onChange:E,className:"hidden",id:"json-file-input"}),e.jsx("label",{htmlFor:"json-file-input",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer transition-colors",children:"Select JSON File"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Expected JSON Format:"}),e.jsx("pre",{className:"text-xs bg-white p-3 rounded border overflow-x-auto",children:`[
  {
    "name": "Movie Title",
    "movie_url": "https://example.com/movie",
    "image_url": "https://example.com/image.jpg",
    "description": "Movie description",
    "rating": 8.5,
    "genres": ["Action", "Adventure"],
    "director": "Director Name",
    "actors": ["Actor 1", "Actor 2"]
  }
]`})]})]})]})}),D&&e.jsx(z,{message:`You're about to import ${m.length} movies. This might take some time to process. Do you want to continue?`,onConfirm:P,onCancel:()=>w(!1),confirmText:"Continue Import"}),N&&d?.duplicates.length&&e.jsx(z,{message:`Found duplicate movie "${d.duplicates[0].movie.name}" (same name and URL already exists). Do you want to skip duplicates and continue importing?`,onConfirm:V,onCancel:()=>j(!1),confirmText:"Skip Duplicates"})]})},ye=()=>{const[a,i]=r.useState(""),[c,u]=U("movie-filter-genre","all",t=>typeof t=="string"),[f,M]=U("movie-sort-by","name",t=>["name","rating","recent","favorites","created_at"].includes(t)),[d,p]=r.useState(1),[b,F]=r.useState(!1),[D,w]=r.useState(!1),[N,j]=r.useState(),{data:m,isLoading:A,refetch:C}=K({search:a,page:d,limit:20}),{addMovie:_,updateMovie:L,deleteMovie:R,importMovies:$,exportMovies:I}=Q(),{favorites:k,toggleFavorite:O}=X(),S=T.useMemo(()=>m?.movies||[],[m?.movies]);console.log(S);const E=T.useMemo(()=>{let t=[...S];return c!=="all"&&(t=t.filter(g=>g.genres?.includes(c))),t.sort((g,y)=>{switch(f){case"rating":return(y.rating||0)-(g.rating||0);case"recent":return new Date(y.created_at).getTime()-new Date(g.created_at).getTime();case"created_at":return new Date(g.created_at).getTime()-new Date(y.created_at).getTime();case"favorites":{const G=`${g.storage_type}-${g.id}`,Z=`${y.storage_type}-${y.id}`,J=k.includes(G)?1:0,B=k.includes(Z)?1:0;return B!==J?B-J:g.name.localeCompare(y.name)}default:return g.name.localeCompare(y.name)}}),t},[S,c,f,k]),P=T.useMemo(()=>{const t=new Set;return S.forEach(g=>{g.genres?.forEach(y=>t.add(y))}),Array.from(t).sort()},[S]),V=async t=>{(await _(t)).success?(v.success(`Successfully added "${t.name}"`),F(!1),C()):v.error("Failed to add movie. Please try again.")},s=async t=>{if(!N?.id)return;(await L(N.id,t)).success?(v.success(`Successfully updated "${t.name}"`),j(void 0),C()):v.error("Failed to update movie. Please try again.")},o=async t=>{t.id&&confirm(`Are you sure you want to delete "${t.name}"?`)&&((await R(t.id)).success?(v.success(`Successfully deleted "${t.name}"`),C()):v.error("Failed to delete movie. Please try again."))},n=t=>{const g=`${t.storage_type}-${t.id}`;O(g)},l=t=>{const g=`${t.storage_type}-${t.id}`;return k.includes(g)},x=async t=>{(await $(t)).success?(v.success(`Successfully imported ${t.length} movie${t.length!==1?"s":""}!`),w(!1),C()):v.error("Failed to import movies. Please try again.")},h=async()=>{(await I()).success?v.success("Movies exported successfully!"):v.error("Failed to export movies. Please try again.")};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900",children:"Movie Directory"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ne,{className:"h-5 w-5"}),"Import JSON"]}),e.jsxs("button",{onClick:()=>F(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(pe,{className:"h-5 w-5"}),"Add Personal Movie"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx("div",{className:"flex-1 max-w-lg",children:e.jsx(te,{onSearch:i})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{value:c,onChange:t=>u(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Genres"}),P.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:f,onChange:t=>M(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"rating",children:"Sort by Rating"}),e.jsx("option",{value:"favorites",children:"Sort by Favorites"}),e.jsx("option",{value:"created_at",children:"Sort by Date (Old First)"}),e.jsx("option",{value:"recent",children:"Sort by Date (New First)"})]})]})]}),E.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold text-gray-800",children:E.length})," of ",e.jsx("span",{className:"font-semibold text-gray-800",children:m?.total||0})," movies",m?.page&&m.page>1&&` (Page ${m.page})`]}),e.jsxs("div",{className:"flex items-center gap-3",children:[m?.serverCount?e.jsxs("span",{className:"px-2.5 py-1 bg-green-50 text-green-700 rounded-full text-xs font-medium border border-green-200",children:[m.serverCount," from library"]}):null,m?.localCount?e.jsxs("span",{className:"px-2.5 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium border border-blue-200",children:[m.localCount," personal"]}):null]})]}),!!m?.localCount&&m.localCount>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm flex-1",children:[e.jsx("p",{className:"text-blue-800 font-medium mb-1",children:"Personal Movie Storage Notice"}),e.jsx("p",{className:"text-blue-700 mb-3",children:"Your personal movies are stored locally in this browser using IndexedDB. This data is browser-specific and may be lost if you clear browser data or use a different browser. We recommend regularly exporting your saved movies to keep a backup."}),e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white text-xs rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(ae,{className:"h-4 w-4"}),"Export Movies"]})]})]})})]})]}),A?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):E.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 xl:gap-10",children:E.map(t=>e.jsx(ee,{movie:t,isFavorite:l(t),onToggleFavorite:n,onEdit:t.storage_type==="indexedDB"?j:void 0,onDelete:t.storage_type==="indexedDB"?o:void 0},`${t.storage_type}-${t.id}`))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No movies found"}),a&&e.jsx("button",{onClick:()=>i(""),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Clear Search"})]}),m&&m.total>20&&e.jsxs("div",{className:"mt-8 flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>p(t=>Math.max(1,t-1)),disabled:d===1,className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 disabled:opacity-50 transition-colors",children:"Previous"}),e.jsxs("span",{className:"px-4 py-2",children:["Page ",d," of ",Math.ceil(m.total/20)]}),e.jsx("button",{onClick:()=>p(t=>t+1),disabled:d>=Math.ceil(m.total/20),className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 disabled:opacity-50 transition-colors",children:"Next"})]}),(b||N)&&e.jsx(se,{movie:N,onSubmit:N?s:V,onCancel:()=>{F(!1),j(void 0)}}),D&&e.jsx(xe,{onImport:x,onCancel:()=>w(!1)})]})};export{ye as MoviesPage};
